<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å°åˆ·ãƒ“ãƒ¥ãƒ¼ã‚¢ - å‡ºåŠ›çµ±åˆãƒ¡ãƒ‹ãƒ¥ãƒ¼</title>

  <style>
  /* ===== ç”»é¢è¡¨ç¤ºç”¨ã‚¹ã‚¿ã‚¤ãƒ« ===== */
  body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f8f9fa;
  }

  header {
    background-color: #0077cc;
    color: white;
    padding: 1rem 2rem;
    font-size: 1.4rem;
    font-weight: bold;
    text-align: center;
  }

  #menu {
    display: flex;
    justify-content: center;
    gap: 1rem;
    padding: 1rem;
    background-color: #e9ecef;
  }

  #menu button {
    background-color: #2a9d8f;
    border: none;
    color: white;
    padding: 10px 20px;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
  }

  #menu button:hover {
    background-color: #21867a;
  }

  /* âœ… ğŸ¯ å°åˆ·ãƒœã‚¿ãƒ³ã ã‘åˆ¥è‰²ã«ï¼ˆ@media ã®å¤–ã«å‡ºã™ï¼ï¼‰ */
  #menu #printBtn {
    background-color: #6c757d;
    color: white;
  }

  #menu #printBtn:hover {
    background-color: #5a6268;
  }

  #content {
    padding: 2rem;
    text-align: center;
  }

  .section-container {
    margin-top: 2rem;
    border-top: 1px solid #ccc;
    padding-top: 1rem;
  }

  #mindmapMetadata {
    text-align: left;
    margin-bottom: 1rem;
    background: #fff;
    border: 1px solid #ccc;
    padding: 1rem;
    border-radius: 6px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  #mindmapImage {
    display: block;
    margin: 1rem auto;
    max-width: 100%;
    border: 1px solid #999;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }

  /* ===== å°åˆ·æ™‚å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« ===== */
  @media print {
    body * {
      visibility: hidden;
    }

    .print-area,
    .print-area * {
      visibility: visible;
    }

    .print-area {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      background: white;
      padding: 2rem;
    }

    header,
    #menu,
    #detailSections {
      display: none !important;
    }
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

</head>
<body>
  <header>ğŸ–¨ï¸ å°åˆ·ãƒ»å‡ºåŠ›ãƒ“ãƒ¥ãƒ¼ã‚¢</header>

  <!-- âœ… ç·åˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
  <div id="menu">
    <button onclick="loadSection('mindmap')">ğŸ§  ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—å˜ä½“</button>
    <button onclick="loadSection('summary')">ğŸ“Š çµ±åˆå‡ºåŠ›ï¼ˆãƒ¬ãƒãƒ¼ãƒˆï¼‰</button>
    <button onclick="loadSection('cards')">ğŸ“‡ å®Ÿè¡Œç­–ä¸€è¦§</button>
    <button onclick="loadSection('3d')">ğŸŒ 3Dãƒ“ãƒ¥ãƒ¼ã‚¢</button>
    <button id="printBtn" onclick="window.print()">ğŸ–¨ï¸ å°åˆ·</button>  </div>

  <div id="content" class="print-area">
    <p>å‡ºåŠ›å†…å®¹ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
  </div>

  <!-- âœ… çµ±åˆå‡ºåŠ›ãªã©ã®è¿½åŠ UIé ˜åŸŸ -->
  <div class="section-container" id="detailSections"></div>

  <script>
 
    function loadSection(type) {
      console.log("loadSection called with type:", type); // â† è¿½åŠ 
      const sessionKey = localStorage.getItem("selectedSessionKey");   
      const sessionData = sessionKey ? JSON.parse(localStorage.getItem(sessionKey)) : null;
      const content = document.getElementById("content");
      const details = document.getElementById("detailSections");
      content.innerHTML = "";
      details.innerHTML = "";

      
  if (type === "mindmap") {
  const region = sessionData?.region || localStorage.getItem("region") || "åœ°åŸŸæœªè¨­å®š";
  const theme = sessionData?.theme || localStorage.getItem("theme") || "ãƒ†ãƒ¼ãƒæœªè¨­å®š";
  const imageData = sessionData?.mindmapImageData || sessionData?.png || localStorage.getItem("mindmapImageData");
  const dateStr = new Date().toLocaleDateString();

  // âœ… Base64 PNGå½¢å¼ã§ã‚ã‚‹ã“ã¨ã‚’å³å¯†ãƒã‚§ãƒƒã‚¯
  if (!imageData || !imageData.startsWith("data:image/png;base64,")) {
    const warning = document.createElement("p");
    warning.textContent = "âŒ ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ç”»åƒãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€ã¾ãŸã¯å½¢å¼ãŒä¸æ­£ã§ã™ã€‚ä¿å­˜ã«å¤±æ•—ã—ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚";
    warning.style.color = "red";
    content.appendChild(warning);
    return;
  }

  // âœ… è¡¨ç¤ºç”¨ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆå°åˆ·ã«ã¯å«ã‚ãªã„ï¼‰
  const metadata = document.createElement("div");
  metadata.id = "mindmapMetadata";
  metadata.innerHTML = `
    <h2>ğŸ§  ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—å‡ºåŠ›</h2>
    <p><strong>åœ°åŸŸåï¼š</strong>${region}</p>
    <p><strong>ãƒ†ãƒ¼ãƒï¼š</strong>${theme}</p>
    <p><strong>å‡ºåŠ›æ—¥ï¼š</strong>${dateStr}</p>
  `;

  // âœ… PNGç”»åƒè¡¨ç¤ºã‚¨ãƒªã‚¢
  const img = document.createElement("img");
  img.id = "mindmapImage";
  img.src = imageData;
  img.alt = "ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ç”»åƒ";
  img.style.maxWidth = "100%";
  img.style.height = "auto";
  img.style.border = "1px solid #ccc";
  img.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";

  // âœ… å°åˆ·å¯¾è±¡ã¨ã—ã¦ãƒ©ãƒƒãƒ—
  const printable = document.createElement("div");
  printable.className = "print-area";
  printable.appendChild(img);

  // âœ… ç”»é¢è¡¨ç¤ºã«è¿½åŠ 
  content.appendChild(metadata);
  content.appendChild(printable);
  details.innerHTML = "<p style='margin-top: 1rem;'>ã“ã®ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ã¯ã€åœ°åŸŸã®èª²é¡Œã¨æ§‹é€ çš„ãªæ€è€ƒã‚’å¯è¦–åŒ–ã—ãŸè³‡æ–™ã§ã™ã€‚ä»Šå¾Œã®å¯¾ç­–ç«‹æ¡ˆã‚„å…±æœ‰ã«æ´»ç”¨ã§ãã¾ã™ã€‚</p>";

  
      } else if (type === "summary") {
  const region = sessionData?.region || "åœ°åŸŸæœªè¨­å®š";
  const theme = sessionData?.theme || "ãƒ†ãƒ¼ãƒæœªè¨­å®š";
  const tasks = sessionData?.tasks || [];
  const insights = sessionData?.insights || "";
  const imageData = sessionData?.mindmapImageData || "";
  const nexcoInfo = sessionData?.nexcoInfo || "[NEXCOæƒ…å ±ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“]";
  const mapImageData = sessionData?.mapImageData || ""; // âœ… åœ°å›³ç”»åƒã®å–å¾—

  // ğŸ”µ è¡¨ç¤ºå°‚ç”¨ã‚¿ã‚¤ãƒˆãƒ«
  const heading = document.createElement("h2");
  heading.textContent = "ğŸ“Š ç·åˆå‡ºåŠ›ãƒ¬ãƒãƒ¼ãƒˆ";

  // ğŸ”µ å°åˆ·å¯¾è±¡ã‚¨ãƒªã‚¢ã®ä¸­èº«
  const printable = document.createElement("div");
  printable.className = "print-area";
  printable.style.textAlign = "left";

  // åœ°åŸŸåï¼‹ãƒ†ãƒ¼ãƒ
  printable.innerHTML += `<h3>åœ°åŸŸåï¼š${region}</h3><p><strong>ãƒ†ãƒ¼ãƒï¼š</strong>${theme}</p>`;

  // èª²é¡Œãƒªã‚¹ãƒˆ
  if (Array.isArray(tasks) && tasks.length > 0) {
    printable.innerHTML += "<h4>æŠ½å‡ºã•ã‚ŒãŸ10ã®èª²é¡Œï¼š</h4><ol>";
    tasks.forEach(task => {
      printable.innerHTML += `<li>${task}</li>`;
    });
    printable.innerHTML += "</ol>";
  }

  // è€ƒå¯Ÿã‚¨ãƒªã‚¢
  printable.innerHTML += `<h4>ä½æ°‘ã®è€ƒå¯Ÿãƒ»åˆ†æã‚³ãƒ¡ãƒ³ãƒˆï¼š</h4><p>${insights || "ï¼ˆæœªå…¥åŠ›ï¼‰"}</p>`;

  // âœ… åœ°å›³ç”»åƒã‚’è¡¨ç¤ºï¼ˆã‚‚ã—ã‚ã‚Œã°ï¼‰
  if (mapImageData && mapImageData.startsWith("data:image/png")) {
    printable.innerHTML += `<h4>åœ°åŸŸãƒãƒƒãƒ—ï¼š</h4><img src="${mapImageData}" alt="åœ°å›³ç”»åƒ" style="max-width:100%; border:1px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">`;
  }

  // âœ… ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ç”»åƒ
  if (imageData) {
    printable.innerHTML += `<h4>ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ï¼š</h4><img src="${imageData}" alt="ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—" style="max-width:100%; border:1px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">`;
  }

  // âœ… NEXCOæƒ…å ±
  printable.innerHTML += `<h4>NEXCOé€£æºæƒ…å ±ï¼š</h4><p>${nexcoInfo}</p>`;

  content.appendChild(heading);
  content.appendChild(printable);
  details.innerHTML = "<p>ã“ã®ã‚¨ãƒªã‚¢ã«ã¯åœ°åŸŸå…¨ä½“ã®èª²é¡Œæ§‹é€ ã¨ä½æ°‘ã®åˆ†æã‚’çµ±åˆè¡¨ç¤ºã—ã¾ã™ã€‚</p>";

      
     } else if (type === "cards") {
  // è¡¨ç¤ºç”¨ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå°åˆ·æ™‚ã«ã¯éè¡¨ç¤ºï¼‰
  const heading = document.createElement("h2");
  heading.textContent = "ğŸ“‡ å®Ÿè¡Œç­–ä¸€è¦§å‡ºåŠ›ï¼ˆãƒã‚¤ãƒ³ãƒ‰ãƒˆãƒªã‚¬ãƒ¼ã‚«ãƒ¼ãƒ‰ï¼‰";

  // å°åˆ·ï¼†è¡¨ç¤ºå…±é€šï¼šãƒã‚¤ãƒ³ãƒ‰ãƒˆãƒªã‚¬ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’ä¸¦ã¹ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ
  const cardContainer = document.createElement("div");
  cardContainer.className = "print-area"; // âœ… å°åˆ·å¯¾è±¡ã¯ã“ã®ä¸­ã ã‘
  cardContainer.style.display = "grid";
  cardContainer.style.gridTemplateColumns = "repeat(auto-fit, minmax(280px, 1fr))";
  cardContainer.style.gap = "1rem";
  cardContainer.style.padding = "1rem";

  // ğŸ”½ ãƒ‡ãƒ¢ç”¨ï¼šçµã‚Šè¾¼ã¿çµæœã®ä»®ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºï¼ˆå¾Œã§ãƒ™ã‚¯ãƒˆãƒ«æŠ½å‡ºçµæœã«å·®ã—æ›¿ãˆï¼‰
  const sampleCards = [
    { strategy: "åœ°åŸŸåŒ»ç™‚ä½“åˆ¶ã®å¼·åŒ–", action: "åŒ»ç™‚äººæèª˜è‡´ãƒ»é éš”è¨ºç™‚æ‹ ç‚¹ã®æ•´å‚™" },
    { strategy: "ç§»ä½å®šä½ä¿ƒé€²ã®åŸºç›¤æ§‹ç¯‰", action: "ç©ºãå®¶ãƒãƒ³ã‚¯ã¨ãƒªãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³è£œåŠ©" },
    { strategy: "è¦³å…‰è³‡æºã®é­…åŠ›æœ€å¤§åŒ–", action: "åœ°åŸŸã‚¬ã‚¤ãƒ‰é¤Šæˆãƒ»ä½“é¨“ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å‰µå‡º" }
  ];

  sampleCards.forEach(cardData => {
    const card = document.createElement("div");
    card.style.border = "1px solid #ccc";
    card.style.borderRadius = "10px";
    card.style.padding = "1rem";
    card.style.backgroundColor = "#fff";
    card.innerHTML = `
      <h4 style="margin-top:0;">${cardData.strategy}</h4>
      <p style="margin-bottom:0.5rem;">${cardData.action}</p>
      <small style="color:gray;">â€» KPIã¯ã‚«ãƒ¼ãƒ‰è©³ç´°ã«è¨˜è¼‰</small>
    `;
    cardContainer.appendChild(card);
  });

  // ãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤ºã«è¿½åŠ ï¼ˆã‚¿ã‚¤ãƒˆãƒ« + ã‚«ãƒ¼ãƒ‰ï¼‰
  content.appendChild(heading);
  content.appendChild(cardContainer);

  details.innerHTML = "<p>ã“ã®ã‚¨ãƒªã‚¢ã«ã¯ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ã¨é€£å‹•ã™ã‚‹å„ªå…ˆå®Ÿè¡Œç­–ï¼ˆMind Trigger Cardsï¼‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>";


      } else if (type === "3d") {
        window.open("3d_viewer.html", "_blank");
      }
    }
    window.addEventListener("DOMContentLoaded", () => {
  const sessionKey = localStorage.getItem("selectedSessionKey");
  const sessionData = sessionKey ? JSON.parse(localStorage.getItem(sessionKey)) : null;
  if (sessionData?.mindmapImageData) {
   
  }
});
  </script>
</body>
</html>
