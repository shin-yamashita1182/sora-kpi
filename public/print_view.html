<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>SORA印刷ビュー</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; padding: 2rem; background: #f4f4f4; }
    .section { margin-bottom: 2rem; background: #fff; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .title { font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem; }
    .map { width: 100%; height: 400px; border: 1px solid #ccc; margin-bottom: 1rem; }
    .mindmap { height: 600px; border: 1px dashed #aaa; margin-top: 1rem; background: #fff; }
    .buttons { text-align: right; margin-top: 1rem; }
    button { margin-left: 0.5rem; padding: 0.6rem 1.2rem; font-size: 1rem; }
  </style>
</head>
<body>

  <div class="section">
    <div class="title">地域とテーマ</div>
    <p id="regionTheme">（例）新上五島町 × 地域活性</p>
  </div>

  <div class="section">
    <div class="title">課題リスト</div>
    <ul id="taskList"></ul>
  </div>

  <div class="section">
    <div class="title">住民の考察</div>
    <p id="insight"></p>
  </div>

  <div class="section">
    <div class="title">マインドマップ</div>
    <div id="mindMapView" class="mindmap"></div>
    <div class="buttons">
      <button onclick="downloadPNG()">PNGで保存</button>
      <button onclick="printPDF()">PDFで出力</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // 1. データ読み込み
    const data = JSON.parse(localStorage.getItem("session_001"));
    document.getElementById("regionTheme").textContent = `${data.region} × ${data.theme}`;
    document.getElementById("insight").textContent = data.insight;
    const taskList = document.getElementById("taskList");
    data.tasks.forEach(task => {
      const li = document.createElement("li");
      li.textContent = task;
      taskList.appendChild(li);
    });

    // 2. マップ再描画（仮でHTML構造、PNGでもOK）
    const map = document.getElementById("mindMapView");
    map.textContent = "ここにマインドマップを再描画 or PNG表示";

    // 3. PDF出力機能
    async function printPDF() {
      const canvas = await html2canvas(document.body);
      const imgData = canvas.toDataURL("image/png");
      const pdf = new jspdf.jsPDF("p", "mm", "a4");
      pdf.addImage(imgData, "PNG", 10, 10, 190, 270);
      pdf.save("SORAマインドマップ.pdf");
    }

    // 4. PNG保存機能
    async function downloadPNG() {
      const canvas = await html2canvas(document.body);
      const link = document.createElement("a");
      link.download = "SORA_mindmap.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    }
  </script>
</body>
</html>
