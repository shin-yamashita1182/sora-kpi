<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å°åˆ·ãƒ“ãƒ¥ãƒ¼ã‚¢ - å‡ºåŠ›çµ±åˆãƒ¡ãƒ‹ãƒ¥ãƒ¼</title>

   <!-- âœ… è¿½åŠ ï¼šã‚«ãƒ¼ãƒ‰è¡¨ç¤ºç”¨ã‚¹ã‚¿ã‚¤ãƒ« -->
  <link rel="stylesheet" href="style.css">

  <style>
  /* ===== ç”»é¢è¡¨ç¤ºç”¨ã‚¹ã‚¿ã‚¤ãƒ« ===== */
  body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f8f9fa;
  }

  header {
    background-color: #0077cc;
    color: white;
    padding: 1rem 2rem;
    font-size: 1.4rem;
    font-weight: bold;
    text-align: center;
  }

  #menu {
    display: flex;
    justify-content: center;
    gap: 1rem;
    padding: 1rem;
    background-color: #e9ecef;
  }

  #menu button {
    background-color: #2a9d8f;
    border: none;
    color: white;
    padding: 10px 20px;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
  }

  #menu button:hover {
    background-color: #21867a;
  }

  /* âœ… ğŸ¯ å°åˆ·ãƒœã‚¿ãƒ³ã ã‘åˆ¥è‰²ã«ï¼ˆ@media ã®å¤–ã«å‡ºã™ï¼ï¼‰ */
  #menu #printBtn {
    background-color: #6c757d;
    color: white;
  }

  #menu #printBtn:hover {
    background-color: #5a6268;
  }

  #content {
    padding: 2rem;
    text-align: center;
  }

  .section-container {
    margin-top: 2rem;
    border-top: 1px solid #ccc;
    padding-top: 1rem;
  }

  #mindmapMetadata {
    text-align: left;
    margin-bottom: 1rem;
    background: #fff;
    border: 1px solid #ccc;
    padding: 1rem;
    border-radius: 6px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  #mindmapImage {
    display: block;
    margin: 1rem auto;
    max-width: 100%;
    border: 1px solid #999;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }

  /* ===== å°åˆ·æ™‚å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« ===== */
  @media print {
    body * {
      visibility: hidden;
    }

    .print-area,
    .print-area * {
      visibility: visible;
    }

    .print-area {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      background: white;
      padding: 2rem;
    }

    header,
    #menu,
    #detailSections {
      display: none !important;
    }
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

</head>
<body>
  <header>ğŸ–¨ï¸ å°åˆ·ãƒ»å‡ºåŠ›ãƒ“ãƒ¥ãƒ¼ã‚¢</header>

  <!-- âœ… ç·åˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
  <div id="menu">
    <button onclick="loadSection('mindmap')">ğŸ§  ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—å˜ä½“</button>
    <button onclick="loadSection('summary')">ğŸ“Š çµ±åˆå‡ºåŠ›ï¼ˆãƒ¬ãƒãƒ¼ãƒˆï¼‰</button>
    <button onclick="loadSection('cards')">ğŸ“‡ å®Ÿè¡Œç­–ä¸€è¦§</button>
    <button onclick="loadSection('3d')">ğŸŒ 3Dãƒ“ãƒ¥ãƒ¼ã‚¢</button>
    <button id="printBtn" onclick="window.print()">ğŸ–¨ï¸ å°åˆ·</button>  </div>

  <div id="content" class="print-area">
    <p>å‡ºåŠ›å†…å®¹ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
  </div>

  <!-- âœ… çµ±åˆå‡ºåŠ›ãªã©ã®è¿½åŠ UIé ˜åŸŸ -->
  <div class="section-container" id="detailSections"></div>

  <script>
 
    function loadSection(type) {
      console.log("loadSection called with type:", type); // â† è¿½åŠ 
      const sessionKey = localStorage.getItem("selectedSessionKey");   
      const sessionData = sessionKey ? JSON.parse(localStorage.getItem(sessionKey)) : null;
      const content = document.getElementById("content");
      const details = document.getElementById("detailSections");
      content.innerHTML = "";
      details.innerHTML = "";

      
  if (type === "mindmap") {
  const region = sessionData?.region || localStorage.getItem("region") || "åœ°åŸŸæœªè¨­å®š";
  const theme = sessionData?.theme || localStorage.getItem("theme") || "ãƒ†ãƒ¼ãƒæœªè¨­å®š";
  const imageData = sessionData?.mindmapImageData || sessionData?.png || localStorage.getItem("mindmapImageData");
  const dateStr = new Date().toLocaleDateString();

  // âœ… Base64 PNGå½¢å¼ã§ã‚ã‚‹ã“ã¨ã‚’å³å¯†ãƒã‚§ãƒƒã‚¯
  if (!imageData || !imageData.startsWith("data:image/png;base64,")) {
    const warning = document.createElement("p");
    warning.textContent = "âŒ ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ç”»åƒãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€ã¾ãŸã¯å½¢å¼ãŒä¸æ­£ã§ã™ã€‚ä¿å­˜ã«å¤±æ•—ã—ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚";
    warning.style.color = "red";
    content.appendChild(warning);
    return;
  }

  // âœ… è¡¨ç¤ºç”¨ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆå°åˆ·ã«ã¯å«ã‚ãªã„ï¼‰
  const metadata = document.createElement("div");
  metadata.id = "mindmapMetadata";
  metadata.innerHTML = `
    <h2>ğŸ§  ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—å‡ºåŠ›</h2>
    <p><strong>åœ°åŸŸåï¼š</strong>${region}</p>
    <p><strong>ãƒ†ãƒ¼ãƒï¼š</strong>${theme}</p>
    <p><strong>å‡ºåŠ›æ—¥ï¼š</strong>${dateStr}</p>
  `;

  // âœ… PNGç”»åƒè¡¨ç¤ºã‚¨ãƒªã‚¢
const img = document.createElement("img");
img.id = "mindmapImage";
img.src = imageData;
img.alt = "ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ç”»åƒ";

// âœ… ã‚¹ã‚¿ã‚¤ãƒ«ä¿®æ­£ï¼ˆã“ã“ãŒè‚ï¼ï¼‰
img.style.width = "100%";
img.style.maxWidth = "1400px";  // å¥½ã¿ã«å¿œã˜ã¦1200ã€œ1600pxç¨‹åº¦
img.style.height = "auto";
img.style.display = "block";
img.style.margin = "1rem auto";
img.style.border = "1px solid #ccc";
img.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";

  // âœ… å°åˆ·å¯¾è±¡ã¨ã—ã¦ãƒ©ãƒƒãƒ—
  const printable = document.createElement("div");
  printable.className = "print-area";
  printable.appendChild(img);

  // âœ… ç”»é¢è¡¨ç¤ºã«è¿½åŠ 
  content.appendChild(metadata);
  content.appendChild(printable);
  details.innerHTML = "<p style='margin-top: 1rem;'>ã“ã®ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ã¯ã€åœ°åŸŸã®èª²é¡Œã¨æ§‹é€ çš„ãªæ€è€ƒã‚’å¯è¦–åŒ–ã—ãŸè³‡æ–™ã§ã™ã€‚ä»Šå¾Œã®å¯¾ç­–ç«‹æ¡ˆã‚„å…±æœ‰ã«æ´»ç”¨ã§ãã¾ã™ã€‚</p>";

  
      } else if (type === "summary") {
  const region = sessionData?.region || "åœ°åŸŸæœªè¨­å®š";
  const theme = sessionData?.theme || "ãƒ†ãƒ¼ãƒæœªè¨­å®š";
  const tasks = sessionData?.tasks || [];
  const category = sessionData?.category || "åˆ†é¡æœªè¨­å®š";
  const insightRaw = sessionData?.insight || [];
  const insights = Array.isArray(insightRaw)
    ? insightRaw.map(line => `ãƒ»${line}`).join("<br>")
    : insightRaw || "ï¼ˆæœªå…¥åŠ›ï¼‰";
  const imageData = sessionData?.mindmapImageData || "";
  const nexcoInfo = sessionData?.nexcoInfo || "[NEXCOæƒ…å ±ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“]";
  const mapImageData = sessionData?.mapImageData || "";

  const heading = document.createElement("h2");
  heading.textContent = "ğŸ“Š ç·åˆå‡ºåŠ›ãƒ¬ãƒãƒ¼ãƒˆ";

  const printable = document.createElement("div");
  printable.className = "print-area";
  printable.style.textAlign = "left";

  // åœ°åŸŸåï¼‹ãƒ†ãƒ¼ãƒï¼‹åˆ†é¡
  printable.innerHTML += `<h3>åœ°åŸŸåï¼š${region}</h3><p><strong>ãƒ†ãƒ¼ãƒï¼š</strong>${theme}</p><p><strong>åˆ†é¡ï¼š</strong>${category}</p>`;

  // èª²é¡Œ
  if (Array.isArray(tasks) && tasks.length > 0) {
    printable.innerHTML += "<h4>æŠ½å‡ºã•ã‚ŒãŸ10ã®èª²é¡Œï¼š</h4><ol>";
    tasks.forEach(task => {
      printable.innerHTML += `<li>${task}</li>`;
    });
    printable.innerHTML += "</ol>";
  }

  // è€ƒå¯Ÿ
  printable.innerHTML += `<h4>ä½æ°‘ã®è€ƒå¯Ÿãƒ»åˆ†æã‚³ãƒ¡ãƒ³ãƒˆï¼š</h4><p>${insights}</p>`;

 // åœ°åŸŸåã«åŸºã¥ã„ãŸGoogleãƒãƒƒãƒ—è¡¨ç¤º
const mapQuery = encodeURIComponent(region);
printable.innerHTML += `
  <h4>åœ°åŸŸãƒãƒƒãƒ—ï¼š</h4>
  <iframe
    width="100%"
    height="300"
    style="border:1px solid #ccc; border-radius:8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);"
    loading="lazy"
    allowfullscreen
    referrerpolicy="no-referrer-when-downgrade"
    src="https://maps.google.com/maps?q=${mapQuery}&output=embed">
  </iframe>
`;

  // ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—
  if (imageData) {
  printable.innerHTML += `<h4>ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ï¼š</h4>
<img src="${imageData}" alt="ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—" 
style="width:100%; max-width:1400px; height:auto; border:1px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display:block; margin:1rem auto;">`;
  }

  // NEXCOæƒ…å ±
  printable.innerHTML += `<h4>NEXCOé€£æºæƒ…å ±ï¼š</h4><p>${nexcoInfo}</p>`;

  content.appendChild(heading);
  content.appendChild(printable);
  details.innerHTML = "<p>ã“ã®ã‚¨ãƒªã‚¢ã«ã¯åœ°åŸŸå…¨ä½“ã®èª²é¡Œæ§‹é€ ã¨ä½æ°‘ã®åˆ†æã‚’çµ±åˆè¡¨ç¤ºã—ã¾ã™ã€‚</p>";

    
     } else if (type === "cards") {
  const heading = document.createElement("h2");
  heading.textContent = "ğŸ“‡ å®Ÿè¡Œç­–ä¸€è¦§å‡ºåŠ›ï¼ˆMindTriggerã‚«ãƒ¼ãƒ‰ï¼‰";

  const cardContainer = document.createElement("div");
  cardContainer.className = "print-area";
  cardContainer.style.display = "flex";
  cardContainer.style.flexWrap = "wrap";
  cardContainer.style.gap = "1rem";
  cardContainer.style.justifyContent = "flex-start";

  // âœ… æ­£ã—ã„ãƒ‘ã‚¹ï¼ˆpublic/test-validation/ ã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã‚€ï¼‰
  fetch("test-validation/coremaster_real_401cards.json")
    .then(res => res.json())
    .then(strategyCards => {
      strategyCards.forEach(item => {
        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
          <div class="viewpoint-tag viewpoint-${convertTagClass(item.perspective)}">${item.perspective}</div>
          <div class="viewpoint-desc">${item.annotation || ""}</div>
          <h2>${item.strategy}</h2>
          <p>${item.policy || "ï¼ˆæ–½ç­–å†…å®¹ãªã—ï¼‰"}</p>
          <p style="color:gray; font-size:0.85rem;">KPIï¼š${item.kpi || "æœªè¨­å®š"}</p>
        `;

        cardContainer.appendChild(card);
      });

      content.appendChild(heading);
      content.appendChild(cardContainer);

      details.innerHTML = "<p>ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã¯ã€<strong>test-validationãƒ›ãƒ«ãƒ€ãƒ¼ã®æœ¬ç‰©ã‚«ãƒ¼ãƒ‰</strong>ã‚’ç›´æ¥å‚ç…§ã—ã¦å‡ºåŠ›ã—ã¦ã„ã¾ã™ã€‚</p>";
    })
    .catch(err => {
      content.appendChild(heading);
      const warning = document.createElement("p");
      warning.textContent = "âŒ ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‘ã‚¹ã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèªã‚’ã—ã¦ãã ã•ã„ã€‚";
      warning.style.color = "red";
      content.appendChild(warning);
    });

      
 } else if (type === "3d") {
    window.open("3d_viewer.html", "_blank");
  }
} // âœ… â† loadSection() é–¢æ•°ã‚’ã“ã“ã§æ­£ã—ãé–‰ã˜ã‚‹ï¼

    
function convertTagClass(perspective) {
  if (perspective.includes("è²¡å‹™")) return "finance";
  if (perspective.includes("é¡§å®¢")) return "customer";
  if (perspective.includes("ãƒ—ãƒ­ã‚»ã‚¹")) return "process";
  if (perspective.includes("å­¦ç¿’")) return "growth";
  return "finance"; // fallback
}
     
    window.addEventListener("DOMContentLoaded", () => {
  const sessionKey = localStorage.getItem("selectedSessionKey");
  const sessionData = sessionKey ? JSON.parse(localStorage.getItem(sessionKey)) : null;
  if (sessionData?.mindmapImageData) {
   
  }
});
  </script>
</body>
</html>
