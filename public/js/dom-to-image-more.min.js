window.domtoimage = {
  toPng: function(node) {
    return new Promise(function(resolve, reject) {
      try {
        const clone = node.cloneNode(true);
        const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute("xmlns", "http://www.w3.org/2000/svg");
        svg.setAttribute("width", node.offsetWidth);
        svg.setAttribute("height", node.offsetHeight);
        const foreignObject = document.createElementNS("http://www.w3.org/2000/svg", "foreignObject");
        foreignObject.setAttribute("width", "100%");
        foreignObject.setAttribute("height", "100%");
        foreignObject.appendChild(clone);
        svg.appendChild(foreignObject);
        const svgData = new XMLSerializer().serializeToString(svg);
        const svgBlob = new Blob([svgData], { type: "image/svg+xml;charset=utf-8" });
        const url = URL.createObjectURL(svgBlob);
        const img = new Image();
        img.onload = function () {
          const canvas = document.createElement("canvas");
          canvas.width = node.offsetWidth;
          canvas.height = node.offsetHeight;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0);
          URL.revokeObjectURL(url);
          resolve(canvas.toDataURL("image/png"));
        };
        img.onerror = function (err) {
          reject(err);
        };
        img.src = url;
      } catch (err) {
        reject(err);
      }
    });
  }
};
